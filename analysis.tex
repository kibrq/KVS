\section*{Анализ}

\subsection*{Предположения}
\begin{enumerate}
	\item Размер значения и ключа, постоянные.
	
	\item Размер блока не слишком большой (4kB).
	
	\item Ключ и значение оффсета помещаются в блок не менее 100 раз
	
	\item Значение помещается в один блок и может быть считано и записано одной элементарной операцией чтения/записи
	
\end{enumerate}

\subsection*{Обозначения}

(const) $N$ -- количество различных ключей, на хранение которых рассчитано хранилище. (100000)

(const) $S_v$ -- размер хранимых значений (в байтах). (2KB)

(const) $S_k$ -- размер хранимых ключей (в байтах). (128b)

(const) $F$ -- объем памяти на используемом флеш-накопителе (в гигабайтах). (128GB)

(const) $E$ -- максимальное количество циклов перезаписи каждой ячейки на используемом флеш-накопителе. (10 000)

(const) $U_w$ -- скорость, с которой поступают запросы на запись. (5 МБ/с)

(variable) $L$ -- максимальное количество записей, единовременно лежащее в Log

(variable) $\nu_L$ -- частота бэкапа

(const) $S_h$ -- размер хэша, распределяющего ключи по блокам (в байтах) ($\sim\lceil\frac{\log_2 \frac{N}{b}}{8}\rceil = 2\ \operatorname{or}\ 3$)

(const) $S_o$ -- размер указателя на позицию в файле (в байтах) ($ \lceil\log_2N\rceil = \frac{17}{8}$)

(const) $b$ -- количество пар ключ-указатель, помещающееся в один блок диска ($\lceil\frac{block\ size}{S_k + S_o}\rceil = 225$)

\subsection*{Метрики}

\large$WA = \frac{S_v + \frac{1}{L}\cdot(\frac{N}{b}\cdot (block\ size))}{S_v + S_k}$\normalsize

$S_v$ -- запись файла

$\frac{N}{b}\cdot (block\ size)$ -- размер индекса, который перезаписывается каждые $L$ записей\\

\large$RA = \frac{L + 2(N-L)}{N} = 2 - \frac{L}{N}$\normalsize

Вероятность найти сразу в логе -- $\frac{L}{N}$, тогда сразу считаем файл с диска, иначе 2 чтения (страница индекса и сам файл)

\large$SA = \frac{N\cdot S_v + \frac{N}{b}\cdot (block\ size)}{N(S_v + S_k)} = \frac{S_v + \frac{block\ size}{b}}{S_v + S_k}$\normalsize

Сами файлы и индекс

\large$MO = \frac{\frac{N}{8} + \frac{N\cdot S_h}{b} + L(S_k + S_o)}{N} = \frac{1}{8} + \frac{S_h}{b} + \frac{L}{N}(S_k + S_o)$\normalsize

Битмаска свободных мест, хэши для промежутков в индексе и лог, соответственно

\large$T = \frac{F\cdot E}{WA\cdot U_w}$\normalsize

\subsection*{Компромиссы}

Выбора тут не очень много, единственная переменная -- размер лога. Её влияние:

$WA\downarrow\downarrow\downarrow\ \ RA \downarrow\ \ MO \uparrow\uparrow\uparrow$

\subsection*{Оптимум}

Подставим конкретные значения из условия:

\large$WA = \frac{2048 + \frac{1}{L}\cdot(\frac{N}{225}\cdot 4096)}{2064} = 0.99 + 0.00882\frac{N}{L}$\normalsize

\large$RA = \frac{L + 2(10^5-L)}{10^5} = 2 - \frac{L}{10^5}$\normalsize

\large$SA = \frac{2048 + \frac{4096}{225}}{2064} = 1.001$\normalsize

\large$MO = \frac{1}{8} + \frac{S_h}{b} + \frac{L}{N}(S_k + S_o) = 0.134 + (18+\frac{1}{8})\frac{L}{N}$\normalsize

Не хочется делать $L$ слишком большим, по нему бегать всё-таки при любом запросе, но для $WA$ его желательно увеличивать. Мне кажется, что значение $2000 (=0.02N)$ вполне подходит под баланс

Итого:

\large$WA = 1.43$\normalsize

\large$RA = 1.98$\normalsize

\large$SA = 1.001$\normalsize

\large$MO = 0.5$\normalsize

\large$T = 5.8$\normalsize лет